version: 2.0

jobs:
    build:
        docker:
            - image: mcr.microsoft.com/dotnet/core/sdk:2.2
        steps:
            - checkout
            - run:
                name: Restore packages
                command: 
                    dotnet restore
            - run:
                name: Build the app
                command:
                    dotnet build
            - run:
                name: Test the app
                command:
                    dotnet test --no-build --logger "trx"
            - run:
                name: Prepare data
                when: always
                command: |
                    dotnet tool install -g trx2junit
                    export PATH="$PATH:/root/.dotnet/tools"
                    trx2junit tests/**/TestResults/*.trx            
            - store_test_results:
                path: tests/TestResults
            - store_artifacts:
                path: tests/TestResults
                destination: TestResults
